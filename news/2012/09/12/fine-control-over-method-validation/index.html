<html>
  <head>
    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>
      Bean Validation - Fine control over method validation in Bean Validation... or not!
    </title>
    <link href="../../../../../stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="../../../../../stylesheets/print.css" media="print" rel="stylesheet" type="text/css">
    <!--[if lt IE 8]>
      <link href="../../../../../stylesheets/ie.css" media="screen, projection" rel="stylesheet" type="text/css">
    <![endif]-->
    <link href="../../../../news.atom" rel="alternate" type="application/atom+xml">
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="/javascripts/patternfly.js"></script>
    <script src="/javascripts/bootstrap.js"></script>
  </head>
  <body>
    <header role="banner">
      <nav class="navbar navbar-default navbar-pf" role="navigation">
        <div class="navbar-header">
          <button class="navbar-toggle" data-target=".navbar-collapse-1" data-toggle="collapse" type="button">
            <span class="sr-only">Toggle Navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../../.." id="logo" title="Bean Validation">
            Bean Validation
          </a>
        </div>
        <div class="collapse navbar-collapse navbar-collapse-1">
          <ul class="nav navbar-nav navbar-primary navbar-right" id="meny-primary">
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../../..">News</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../../../../specification">Specification</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../../../../tck">TCK</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../../../../1.1/ri">RI</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../../../../1.1/certified">Certified</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../../../../contribute">Contribute</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../../../../licensing">Licensing</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <div class="container" id="overview">
      <div class="clearfix row" id="content">
        <div class="col-sm-9 col-md-9 col-lg-9 clearfix" id="main">
          <article class="post">
            <header>
              <h1 class="title">
                Fine control over method validation in Bean Validation... or not!
              </h1>
              <span class="author">
                by
                <b>Emmanuel Bernard</b>
              </span>
              <span class="date">
                on 12 Sep 2012
              </span>
              <span class="tags">
                <a class="label label-info" href="/news/tags/feedback-needed/">feedback-needed</a>
              </span>
            </header>
            <div class="body">
              <p>I need your feedback on whether or not you need fine controls on method
              validation.</p>
              
              <h2>Some context</h2>
              
              <p>Bean Validation 1.1 introduces the idea of method validation. When
              the method is called, parameters and return value can be validated.
              The constraints are of course defined as Bean Validation constraint
              annotations.</p>
              
              <p>I am working on the chapter describing how interceptor technologies like
              CDI, EJB, Spring, Guice, AspectJ should integrate it.</p>
              
              <p>We have decided to convert most of the
              recommendations into mandatory rules. In particular, methods annotated
              with constraints should be validated by the integration technology
              by default.</p>
              
              <p>Early in the design we have introduced an annotation <code>@MethodValidated</code>
              that lets you control a few things:</p>
              
              <ul>
              <li>which group should be used for validation (defaulting to <code>Default</code>)</li>
              <li>what part should be validated: parameters, return value, both or none</li>
              </ul>
              
              
              <p>This annotation made sense when validation was not on by default but I am
              now questioning its usefulness.</p>
              
              <p><strong>I have a bunch of questions for you</strong>. I tried to keep them short and to
              the point so feel free to answer them one by one. They also go from easy
              to more convoluted. Are you up for the challenge?</p>
              
              <p>Note that I have added a bonus question in the end.</p>
              
              <h2>What's your use case for disabling method validation?</h2>
              
              <p>Why would you want to disable method validation on a given method or a
              given class?</p>
              
              <pre><code>public class UserService {&#x000A;    @MethodValidated(validationMode=NONE)&#x000A;    public void createUser(&#x000A;        @NotEmpty @Email String email,&#x000A;        @Valid Address address ) {&#x000A;        ...&#x000A;    }&#x000A;}&#x000A;</code></pre>
              
              <p>If you have a use case, would it be fulfilled with the <code>@MethodValidated</code>
              annotation as described?</p>
              
              <h2>What's your use case for changing the default group?</h2>
              
              <p><code>@MethodValidated(groups=Heavy.class)</code> let's you change validation from
              the <code>Default</code> group to the group of your choice - in this case <code>Heavy</code>.</p>
              
              <p>Provided that we will offer support for group translation when cascading
              <a href="http://beanvalidation.org/proposals/BVAL-208/">http://beanvalidation.org/proposals/BVAL-208/</a></p>
              
              <pre><code>public class UserService {&#x000A;    public void createUser(&#x000A;        @NotEmpty @Email String email,&#x000A;        @Valid @ConvertGroup(from=Default.class, to=BasicPostal.class)&#x000A;        Address address ) {&#x000A;        ...&#x000A;    }&#x000A;}&#x000A;</code></pre>
              
              <p>do we really need the ability do decide which group to use to validate a
              given method? What would be the use case?</p>
              
              <p>To me it seems that it could makes sense to validate one group over
              another based on:</p>
              
              <ul>
              <li>some environmental consideration
              say a newbie user has more constraints on how it enters data
              than an advanced user hence different groups</li>
              <li>the caller
              say a branch of the code wants to apply different rules than
              an other</li>
              </ul>
              
              
              <p>In both case, it does not make sense to define the group via an
              annotation on the method to be validated.
              This would need to be a rather container specific behavior to let people
              inject the right group for the right context.</p>
              
              <h2>When would you want to only validate parameters or return values?</h2>
              
              <p><code>@MethodValidated.validationMode</code> let's you validate both method
              parameters as well as return value, or either one of them or none at all.</p>
              
              <pre><code>@MethodValidated(validationMode=PARAMETERS)&#x000A;public class UserService {&#x000A;    @Valid&#x000A;    public User createUser(&#x000A;        @NotEmpty @Email String email,&#x000A;        @Valid Address address ) {&#x000A;        ...&#x000A;    }&#x000A;}&#x000A;</code></pre>
              
              <p>Do you have a use case in mind for such need?</p>
              
              <h2>What inheritance rules make sense for <code>@MethodValidated</code>?</h2>
              
              <p>Assuming we have <code>@MethodValidated</code>, we need to define the overriding
              rules.</p>
              
              <p>We could decide that <code>@MethodValided</code> must be placed on the method to be
              validated (no overriding rule), or we could try and add some or all of
              the following rules:</p>
              
              <ol>
              <li><code>@MethodValidated</code> definitions on a method overrides the ones on a class</li>
              <li><code>@MethodValidated</code> definition on a subclass overrides the ones on superclasses</li>
              </ol>
              
              
              <p>Here is an example</p>
              
              <pre><code>//example of rule 1&#x000A;@MethodValidated(validationMode=PARAMETERS)&#x000A;public class UserService {&#x000A;    @MethodValidated(validationMode=BOTH)&#x000A;    @Valid&#x000A;    public User createUser(&#x000A;        @NotEmpty @Email String email,&#x000A;        @Valid Address address ) {&#x000A;        ...&#x000A;    }&#x000A;}&#x000A;</code></pre>
              
              <p>Interfaces make things harder as there would be no magic rule to decide
              which definition has precedence over another in case of conflict.</p>
              
              <p>We could consider that methods of a class implementing an interface
              inherit the interface hosted <code>@MethodValidated</code> definition (unless overridden).
              And in case two interfaces define the same method, overriding the
              <code>@MethodValidated</code> definition would be mandatory.</p>
              
              <p>I can live with rule 1, I can support rule 2. but I feel that the rules
              related to interfaces make things quite complex and not especially
              readable. Plus I don't see why you would want to add <code>@MethodValidated</code>
              on an interface. Not surprising as I don't see why one would do it on a
              class method anyways ;)</p>
              
              <p>What do you make of that?</p>
              
              <h2>You are a convinced @MethodValidated fan? What about the name?</h2>
              
              <p>We have never found a good name for this annotation anyways. If you
              like and want this annotation, how should it be named?</p>
              
              <p>Yep that's the bonus question, sorry.</p>
              
              <h2>Conclusion</h2>
              
              <p>I realize that it must look like I am having a <code>@MethodValidated</code>
              mid-life crisis but better now than later :D</p>
            </div>
            <footer>
              <div id="post-navigation">
                <div class="previous">
                  &laquo;
                  <a href="../../../08/31/big-push-on-bean-validation">Big push on Bean Validation 1.1</a>
                </div>
                <div class="next">
                  &raquo;
                  <a href="../../../10/22/release-1-1-public-review">Public Review Draft for Bean Validation 1.1</a>
                </div>
              </div>
              
                          <div id="disqus_thread"></div>
                          <script type="text/javascript">
                          var disqus_shortname = 'beanvalidation';
                          var disqus_url = "http://beanvalidation.org/news/2012/09/12/fine-control-over-method-validation/";
                          var disqus_developer = null;
                          var disqus_identifier = null;
                          (function() {
                            var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
                            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                            (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
                          })();
                          </script>
                          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=beanvalidation">comments powered by Disqus.</a></noscript>
            </footer>
          </article>
        </div>
        <div class="sidebar sidebar-right col-sm-3 col-md-3 col-lg-3" id="sidebar" role="complementary">
          <div id="newsfeed">
            <h2>
              <a href="/news/news.atom"><img alt="atom feed" src="/images/feed-icon-28x28.png"></a>
              <a href="/news/news.atom">
                Latest news
              </a>
            </h2>
            <div id="newsfeed-message">
              Stay up to date, subscribe to the&nbsp;<a href="/news/news.atom">news feed</a>.
            </div>
          </div>
          <a class="news-link" href="/news/2017/06/26/bean-validation-2-0-proposed-final-draft-released/">Proposed Final Draft of Bean Validation 2.0 released</a>
          <a class="news-link" href="/news/2017/05/24/bean-validation-2-0-public-review-update/">Update to the Bean Validation 2.0 Public Review Draft</a>
          <a class="news-link" href="/news/2017/05/12/feedback-on-positive-and-negative-constraints/">Survey - Behavior of @Positive and @Negative constraints</a>
          <a class="news-link" href="/news/2017/04/26/bean-validation-2-0-up-for-public-review/">Bean Validation 2.0 is up for Public Review</a>
          <a class="news-link" href="/news/2017/03/31/bean-validation-2-0-alpha2-is-out/">Bean Validation 2.0 Alpha2 is out</a>
          <a class="news-link" href="/news/2017/02/16/first-alpha-of-bean-validation-2-0-reference-implementation/">First Alpha of Bean Validation 2.0 Reference Implementation Available</a>
          <a class="news-link" href="/news/2017/02/14/bean-validation-2-0-early-draft-released/">Bean Validation 2.0 Early Draft 1 is Out</a>
          <a class="news-link" href="/news/2017/02/07/apache-bval-is-compatible-with-bean-validation-1-1/">Apache BVal certified as Bean Validation 1.1 implementation</a>
          <a class="news-link" href="/news/2017/01/19/bean-validation-2-0-progress-report/">Bean Validation 2.0 Progress Report</a>
          <a class="news-link" href="/news/2016/11/23/survey-constraints-and-parameterized-type/">Survey - Where do you use constraints on parameterized type?</a>
          <a class="news-link" href="/news/2016/09/15/which-constraints-to-add/">Feedback needed - Which constraints should be added?</a>
          <a class="news-link" href="/news/2016/07/15/bean-validation-2-0-is-coming/">Bean Validation 2.0 - A new JSR is born!</a>
          <a class="news-link" href="/news/2015/06/18/bean-validation-tck-1-1-4-released/">Bean Validation TCK 1.1.4.Final released</a>
          <a class="news-link" href="/news/2014/06/18/bean-validation-tcks-now-with-support-for-java-se-8/">Bean Validation TCKs now with signature files for Java SE 8</a>
          <a class="news-link" href="/news/2014/05/28/training-materials/">Training materials on Bean Validation 1.1</a>
          <a class="news-link" href="/news/2013/06/04/xml-namespace-and-jcp/">XML namespace and JCP</a>
          <a class="news-link" href="/news/2013/05/02/bean-validation-1-1-is-a-spec/">Bean Validation 1.1 is a spec</a>
          <a class="news-link" href="/news/2013/03/21/bean-validation-1-1-final-approval-ballot/">Bean Validation 1.1 CR3 - Final Approval Ballot</a>
          <a class="news-link" href="/news/2013/02/20/bean-validation-1-1-proposed-final-draft/">Bean Validation 1.1 CR1 - Proposed Final Draft</a>
          <a class="news-link" href="/news/2013/02/15/bean-validation-1-1-beta4/">Bean Validation 1.1 Beta 4 - issue smashing edition</a>
          <a class="news-link" href="/news/2013/02/05/javaspotlight-podcast-on-bean-validation-1-1/">Java Spotlight Podcast on Bean Validation 1.1</a>
          <a class="news-link" href="/news/2013/02/01/bean-validation-1-1-beta3-last-line/">Bean Validation 1.1 Beta 3 - the last line</a>
          <a class="news-link" href="/news/2012/12/18/bean-validation-in-the-press/">Bean Validation in the press</a>
          <a class="news-link" href="/news/2012/12/11/should-getters-be-considered-methods/">Should getters be validated when they are called?</a>
          <a class="news-link" href="/news/2012/11/29/public-review-ballot/">Public review ballot favorable to Bean Validation 1.1</a>
          <a class="news-link" href="/news/2012/11/27/1-1-beta2-is-out/">Bean Validation 1.1 Beta 2 is out</a>
          <a class="news-link" href="/news/2012/10/22/release-1-1-public-review/">Public Review Draft for Bean Validation 1.1</a>
          <a class="news-link" href="/news/2012/09/12/fine-control-over-method-validation/">Fine control over method validation in Bean Validation... or not!</a>
          <a class="news-link" href="/news/2012/08/31/big-push-on-bean-validation/">Big push on Bean Validation 1.1</a>
          <a class="news-link" href="/news/2012/08/29/methodvalidation-inheritance/">Method validation and inheritance - feedback needed!</a>
          <a class="news-link" href="/news/2012/06/28/hibernate-validator-5-alpha/">Hibernate Validator 5 alpha for Bean Validation 1.1 is out</a>
          <a class="news-link" href="/news/2012/06/06/continuous-publication-specification-snapshot/">Continuous publication of the specification snapshot</a>
          <a class="news-link" href="/news/2012/03/28/jcp-release-1-1-edr1/">Bean Validation 1.1 officially reaches the JCP</a>
          <a class="news-link" href="/news/2012/03/16/artifacts-1-1-edr1/">Code artifacts published for Bean Validation 1.1 early draft 1</a>
          <a class="news-link" href="/news/2012/03/13/release-1-1-edr1/">Bean Validation 1.1 early draft 1 is out - time for feedback</a>
          <a class="news-link" href="/news/2012/02/01/method-level-proposal/">Proposal for method validation added</a>
          <a class="news-link" href="/news/2011/10/21/dependency-injection-proposal/">Adding proposal section and first proposal</a>
          <a class="news-link" href="/news/2011/09/16/method-level-validation/">Work on method level validation</a>
          <a class="news-link" href="/news/2011/09/01/spec-repository-out/">The specification repository is released</a>
          <a class="news-link" href="/news/2011/07/23/voted-yes/">Bean Validation has been voted yes!</a>
          <a class="news-link" href="/news/2011/07/22/review-ballot/">Bean Validation in review ballot</a>
          <a class="news-link" href="/news/2011/07/21/Site-is-live/">The website is live!</a>
        </div>
      </div>
    </div>
  </body>
  <footer class="container" id="widget-footer" role="contentinfo">
    <hr>
    <div class="row">
      <div class="widget col-md-12 widget_text">
        Copyright (c) Red Hat, Inc., Emmanuel Bernard
        <a href="http://redhat.com" id="logo-redhat">Red Hat</a>
      </div>
    </div>
  </footer>
  <script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
   
  ga('create', 'UA-24703879-1', 'auto');
  ga('send', 'pageview');
  
  </script>
</html>
