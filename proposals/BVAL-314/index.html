<html>
  <head>
    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>
      Bean Validation - Provide ability to disable validation and customize groups for method/constructor validation
    </title>
    <link href="../../stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="../../stylesheets/print.css" media="print" rel="stylesheet" type="text/css">
    <!--[if lt IE 8]>
      <link href="../../stylesheets/ie.css" media="screen, projection" rel="stylesheet" type="text/css">
    <![endif]-->
    <link href="../../news/news.atom" rel="alternate" type="application/atom+xml">
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="/javascripts/patternfly.js"></script>
    <script src="/javascripts/bootstrap.js"></script>
  </head>
  <body>
    <header role="banner">
      <nav class="navbar navbar-default navbar-pf" role="navigation">
        <div class="navbar-header">
          <button class="navbar-toggle" data-target=".navbar-collapse-1" data-toggle="collapse" type="button">
            <span class="sr-only">Toggle Navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../.." id="logo" title="Bean Validation">
            Bean Validation
          </a>
        </div>
        <div class="collapse navbar-collapse navbar-collapse-1">
          <ul class="nav navbar-nav navbar-primary navbar-right" id="meny-primary">
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../..">Home</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../news">News</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../1.1">Specification</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../1.1/tck">TCK</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../1.1/ri">RI</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../1.1/certified">Certified</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../contribute">Contribute</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../licensing">Licensing</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <div class="container" id="overview">
      <div class="clearfix row" id="content">
        <div class="col-sm-12 col-md-12 col-lg-12 clearfix" id="main">
          <h1>Provide ability to disable validation and customize groups for method/constructor validation</h1>
          <p><a href="https://hibernate.onjira.com/browse/BVAL-314">Link to JIRA ticket</a></p>
          
          <h2>Problem</h2>
          
          <p>Decide which mechanism should be offered to disable method validation and
          customize the group used for method validation.
          We have discovered that an annotation on the validated method itself does
          not solve any of the interesting use case.</p>
          
          <h2>Proposal</h2>
          
          <p>There are several angles to let developers customize method validation:</p>
          
          <ol>
          <li>leave it specific to each provider (easy way but feeling incomplete)</li>
          <li>leave it to the interception technology (ie CDI, AspectJ etc), that's just moving the issue around and we need to define it for CDI anyways</li>
          <li>offer a component customizing the group to validate and whether or not to validate a method</li>
          <li>We should also offer a way to disable validation entirely in the xml deployment descriptor</li>
          </ol>
          
          
          <p>I'm inclined to offer 3 and 4 at the moment</p>
          
          <p>Here is a fleshed out proposal (integrated in the specification for feedback).</p>
          
          <p>By default, all constrained methods (that can be intercepted) are validated using the
          default group.</p>
          
          <p>You can customize whether or not a method is validated and which group is used via
          the <code>MethodValidationActivator</code> and <code>MethodValidationGroupSelector</code> contracts and providing
          implementations to the Bean Validation bootstrap or via the XML deployment descriptor.</p>
          
          <pre><code>/**&#x000A; * Decides if constraints of a given method should be validated&#x000A; *&#x000A; * @author Emmanuel Bernard&#x000A; */&#x000A;interface MethodValidationActivator {&#x000A;    boolean activateMethodValidation(Method method):&#x000A;    boolean activateConstructorValidation(Constructor constructor);&#x000A;}&#x000A;&#x000A;/**&#x000A; * Provides the (set of) groups that should be used when validating the&#x000A; * given constrained method.&#x000A; *&#x000A; * @author Emmanuel Bernard&#x000A; */&#x000A;interface MethodValidationGroupSelector {&#x000A;    Class&lt;?&gt;[] selectGroupsForMethod(Method method):&#x000A;    Class&lt;?&gt;[] selectGroupsForConstructor(Constructor constructor);&#x000A;}&#x000A;</code></pre>
          
          <blockquote><p>Note: <code>MethodValidationActivator</code> and <code>MethodValidationGroupSelector</code> are horrible
          names, we need to find different ones</p></blockquote>
          
          <p>The components <code>MethodValidationActivator</code> and <code>MethodValidationGroupSelector</code> are accepting
          injection points in a container environment (CDI in particular). Implementations must be thread-safe.</p>
          
          <p>Method and constructor validations can be globally disabled via the XML configuration descriptor by
          using the <code>disable-method-validation</code> element. Likewise, you can disable validation for a specific
          method / constructor or for all methods / constructors of a given bean by using the
          <code>disable-method-validation</code> attribute on the respective elements.</p>
          
          <blockquote><p>TODO: should we change the boolean <code>disable-method-validation</code> with the following enum based
          <code>method-validation</code>: <code>NONE</code>, <code>PARAMETERS</code>, <code>RETURN_VALUE</code>, <code>ALL</code>. What would be the use case
          for <code>PARAMETERS</code> / <code>RETURN_VALUE</code>? We could also use the enum but restrict it to <code>NONE</code> and
          <code>ALL</code> to plan for the future.</p></blockquote>
          
          <p>Here are a few use cases :</p>
          
          <ul>
          <li>choose a different group depending on the caller stack: a batch input might want different validation than a user input</li>
          <li>choose a different group depending on a specific context: if a user is flagged as rogue, enforce more constraints</li>
          <li>disable validations for a given deployment as it is considered a "safe" environment</li>
          <li>disable a specific method validation for development purposes either via a custom
          <code>MethodValidationGroupSelector</code> implementation or via the XML deployment descriptor</li>
          </ul>
          
          
          <p>Context or caller stack implementations can be implemented in a couple of ways:</p>
          
          <ul>
          <li><p>use a thread local variable to carry the groups</p></li>
          <li><p>use a request scoped CDI component to carry the groups: this component being injected in the
          <code>MethodValidationGroupSelector</code> implementation.</p></li>
          </ul>
          
          
          <blockquote><p>Should we provide in the CDI integration a way to customize the group via an annotation?
          An annotation in the caller stack would set the expected group. This would resurrect the
          <code>@MethodValidated</code> annotation but not on the validated method itself.</p></blockquote>
          
                      <div id="disqus_thread"></div>
                      <script type="text/javascript">
                      var disqus_shortname = 'beanvalidation';
                      var disqus_url = "http://beanvalidation.org/proposals/BVAL-314/";
                      var disqus_developer = null;
                      var disqus_identifier = null;
                      (function() {
                        var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
                      })();
                      </script>
                      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=beanvalidation">comments powered by Disqus.</a></noscript>
        </div>
      </div>
    </div>
  </body>
  <footer class="container" id="widget-footer" role="contentinfo">
    <hr>
    <div class="row">
      <div class="widget col-md-12 widget_text">
        Copyright (c) Red Hat, Inc., Emmanuel Bernard
        <a href="http://redhat.com" id="logo-redhat">Red Hat</a>
      </div>
    </div>
  </footer>
</html>
