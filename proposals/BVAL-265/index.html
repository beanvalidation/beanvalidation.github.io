<html>
  <head>
    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>
      Bean Validation - Expose settings defined in XML in the Configuration API (for ConstraintValidatorFactory, MessageInterpolator etc)
    </title>
    <link href="../../stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="../../stylesheets/print.css" media="print" rel="stylesheet" type="text/css">
    <!--[if lt IE 8]>
      <link href="../../stylesheets/ie.css" media="screen, projection" rel="stylesheet" type="text/css">
    <![endif]-->
    <link href="../../news/news.atom" rel="alternate" type="application/atom+xml">
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="/javascripts/patternfly.js"></script>
    <script src="/javascripts/bootstrap.js"></script>
  </head>
  <body>
    <header role="banner">
      <nav class="navbar navbar-default navbar-pf" role="navigation">
        <div class="navbar-header">
          <button class="navbar-toggle" data-target=".navbar-collapse-1" data-toggle="collapse" type="button">
            <span class="sr-only">Toggle Navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../.." id="logo" title="Bean Validation">
            Bean Validation
          </a>
        </div>
        <div class="collapse navbar-collapse navbar-collapse-1">
          <ul class="nav navbar-nav navbar-primary navbar-right" id="meny-primary">
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../..">Home</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../news">News</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../1.1">Specification</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../1.1/tck">TCK</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../1.1/ri">RI</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../1.1/certified">Certified</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../contribute">Contribute</a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-page">
              <a href="../../licensing">Licensing</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <div class="container" id="overview">
      <div class="clearfix row" id="content">
        <div class="col-sm-12 col-md-12 col-lg-12 clearfix" id="main">
          <h1>Expose settings defined in XML in the Configuration API (for ConstraintValidatorFactory, MessageInterpolator etc)</h1>
          <p><a href="https://hibernate.onjira.com/browse/BVAL-265">Link to JIRA</a></p>
          
          <h2>Goals</h2>
          
          <p>While working on the dependency injection (BVAL-238), I need to solve a subproblem. A container needs to know what is in <code>validation.xml</code>
          to either:</p>
          
          <ul>
          <li>plug its <code>ConstraintValidatorFactory</code> / <code>MessageResolver</code> etc implementation,</li>
          <li>use the one defined by the user and possibly instantiate these objects as managed objects</li>
          </ul>
          
          
          <p>There are a few strategies</p>
          
          <h2>Option 1: Let the XML parsing be done by the DI bootstrap code</h2>
          
          <p>The easiest solution is to leave the container read <code>validation.xml</code> and extract information itself. No need to change the API in this case.</p>
          
          <h2>Option 2: Expose the data on the <code>Configuration</code> object as strings</h2>
          
          <p>Add three methods to <code>Configuration</code> to return the explicit value (if set) and null otherwise:</p>
          
          <ul>
          <li><code>String getConstraintValidatorFactoryFromXML()</code></li>
          <li><code>String getMessageInterpolatorFromXML()</code></li>
          <li><p><code>String getTraversableResolverFromXML()</code></p>
          
          <p>  //example of bootstrap code by the container
            Configuration conf = Validation
                .byDefaultProvider()
                .configure();</p>
          
          <p>  String cVFClassName = conf.getConstraintValidatorFactoryFromXML();
            ConstraintValidatorFactory cVF;
            if (cVFClassName == null) {
               //use DI custom one
               cVF = new ContainerCustomConstraintValidatorFactory();
            }
            else {
               cVF = Container.getManagedBean(cVFClassName);
            }</p>
          
          <p>  //same logic for MessageResolver and TraversableResolver
            [...]</p>
          
          <p>  conf.constraintValidatorFactory(cVF)
               .messageResolver(messageRes)
               .traversableResolver(traversRes)
               .buildValidatorFactory();</p></li>
          </ul>
          
          
          <p>The spec would recommend that <code>getConstraintValidatorFactoryFromXML()</code> and its siblings lazily read the XML file.</p>
          
          <h2>Option 3: Expose the data in <code>Configuration</code> as instantiated objects</h2>
          
          <p>Same as above except that <code>Configuration</code> returns already instantiated objects. But I don't think that's an
          interesting option.</p>
          
          <h2>Discussion</h2>
          
          <p>Which options should be favor? I am tempted by option 2 but the risk is an explosion of <code>getDefaultXXX()</code>
          and <code>getXXXFromXML()</code> the more we add components to Bean Validation.</p>
          
          <p>What do you think?</p>
          
                      <div id="disqus_thread"></div>
                      <script type="text/javascript">
                      var disqus_shortname = 'beanvalidation';
                      var disqus_url = "http://beanvalidation.org/proposals/BVAL-265/";
                      var disqus_developer = null;
                      var disqus_identifier = null;
                      (function() {
                        var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
                      })();
                      </script>
                      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=beanvalidation">comments powered by Disqus.</a></noscript>
        </div>
      </div>
    </div>
  </body>
  <footer class="container" id="widget-footer" role="contentinfo">
    <hr>
    <div class="row">
      <div class="widget col-md-12 widget_text">
        Copyright (c) Red Hat, Inc., Emmanuel Bernard
        <a href="http://redhat.com" id="logo-redhat">Red Hat</a>
      </div>
    </div>
  </footer>
</html>
